<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Menu Style</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load required fonts and the main stylesheet -->
    <link rel="stylesheet" href="styles.css"> 
    
    <style>
        /* Specific styles for the selector page preview cards */
        .style-card {
            cursor: pointer;
            border: 4px solid transparent;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            color: var(--primary-text); 
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .style-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
        }
        
        .style-card.selected {
            border-color: var(--primary-accent);
            box-shadow: 0 0 0 6px rgba(46, 139, 87, 0.3);
        }

        /* Theme-specific Card Backgrounds */
        .theme-light-card { 
            background-color: #FFFFFF; 
            color: #1F2937; 
        }
        
        .theme-dark-card { 
            background-color: #2B2B2B; 
            color: #C8C8C8; 
        } 
        
        .theme-holiday-card { 
            background-color: #296054; 
            color: #F0F0E0; 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle fill='%23FFD700' fill-opacity='0.4' cx='0' cy='0' r='2'%3E%3C/circle%3E%3Ccircle fill='%23FFD700' fill-opacity='0.4' cx='20' cy='20' r='2'%3E%3C/circle%3E%3C/svg%3E");
            background-size: 40px 40px;
        }
        
        /* Font Preview Classes */
        .font-preview-light { 
            font-family: 'Parisienne', cursive; 
            font-weight: 400; 
        } 
        
        .font-preview-dark { 
            font-family: 'Parisienne', cursive; 
            font-weight: 400; 
        }  
        
        .font-preview-holiday { 
            font-family: 'Playfair Display', serif; 
            font-weight: 900; 
        }
        
        /* Ensure return button adapts to current theme */
        .return-button {
            background-color: var(--primary-accent);
            color: var(--background-card);
        }
        
        .return-button:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body class="theme-light p-4 sm:p-8">
    <div class="w-full max-w-5xl mx-auto bg-white p-6 sm:p-12 rounded-2xl shadow-2xl border border-gray-200">
        
        <h1 class="elegant-title text-5xl md:text-6xl text-center">Menu Style</h1>
        
        <p class="text-center text-lg mt-16 mb-10" style="color: var(--secondary-text);">
            Click one of the options below to set the menu style.
        </p>
        
        <div id="loadingMessage" class="text-center text-lg mt-10 font-bold">Loading styles...</div>

        <div id="styleOptions" class="grid grid-cols-1 md:grid-cols-3 gap-8 hidden">
            <!-- Style cards will be dynamically generated here -->
        </div>

        <div id="statusMessage" class="text-center mt-6 font-semibold min-h-[20px]"></div>

        <div class="text-center mt-12">
            <a href="./atlas_cocktail_menu.html" 
               class="return-button inline-block px-6 py-3 font-bold rounded-full transition duration-300 shadow-lg">
                Return to Cocktail Menu
            </a>
        </div>
    </div>

    <script type="module">
        
        const styleOptionsEl = document.getElementById('styleOptions');
        const loadingMessageEl = document.getElementById('loadingMessage');
        const statusMessageEl = document.getElementById('statusMessage');

        // Styles definitions for display and saving
        const styles = [
            { 
                id: 'light', 
                name: 'Elegant Light', 
                className: 'theme-light-card', 
                accentColor: '#10B981', 
                bg: '#FFFFFF', 
                text: '#1F2937',
                description: 'Clean and classic'
            },
            { 
                id: 'dark', 
                name: 'Elegant Dark', 
                className: 'theme-dark-card', 
                accentColor: '#B8860B', 
                bg: '#2B2B2B', 
                text: '#C8C8C8',
                description: 'Sophisticated evening'
            },
            { 
                id: 'holiday', 
                name: 'Holiday', 
                className: 'theme-holiday-card', 
                accentColor: '#FFD700', 
                bg: '#296054', 
                text: '#F0F0E0',
                description: 'Festive celebration'
            }
        ];

        // Key used in localStorage
        const THEME_STORAGE_KEY = 'cocktailThemeId';

        function loadCurrentStyle() {
            // Read the theme ID directly from localStorage, defaulting to 'light'
            const currentStyleId = localStorage.getItem(THEME_STORAGE_KEY) || 'light';

            // Apply the loaded style to the body
            document.body.className = `theme-${currentStyleId}`;
            console.log(`[Theme Selector] Applied current theme: ${currentStyleId}`);
            
            return currentStyleId;
        }

        function saveStyle(themeId) {
            try {
                // Save the theme ID to localStorage
                localStorage.setItem(THEME_STORAGE_KEY, themeId);
                
                statusMessageEl.innerHTML = `<span style="color: var(--primary-accent);">âœ“ Style saved! Visit the cocktail menu to see your selection.</span>`;
                
                // Update the current style on the page
                document.body.className = `theme-${themeId}`;
                
                // Update card selection state
                document.querySelectorAll('.style-card').forEach(card => card.classList.remove('selected'));
                document.getElementById(`card-${themeId}`).classList.add('selected');
                
                console.log(`[Theme Selector] Theme updated to ${themeId}.`);

            } catch (error) {
                console.error("[Theme Selector ERROR] Failed to save style preference:", error);
                statusMessageEl.innerHTML = `<span style="color: #EF4444;">Error saving style. Please try again.</span>`;
            }
        }

        function renderStyleOptions() {
            const currentStyleId = loadCurrentStyle();
            
            // Render the options
            styleOptionsEl.innerHTML = styles.map(style => `
                <div id="card-${style.id}" 
                     class="style-card p-6 rounded-lg text-center ${style.className} 
                            ${style.id === currentStyleId ? 'selected' : ''}" 
                     data-theme-id="${style.id}"
                     onclick="saveStyleHandler('${style.id}')">
                    
                    <div>
                        <h3 class="text-3xl font-bold mb-3 font-preview-${style.id}" 
                            style="color: ${style.accentColor};">
                            ${style.name}
                        </h3>
                        <p class="text-sm mb-4 opacity-80">${style.description}</p>
                    </div>
                    
                    <div>
                        <div class="h-12 rounded-sm border border-opacity-30" 
                             style="background-color: ${style.bg}; border-color: ${style.text};"></div>
                        <p class="text-xs mt-2 opacity-60">Click to select</p>
                    </div>
                </div>
            `).join('');

            // Hide loading and show content
            loadingMessageEl.classList.add('hidden');
            styleOptionsEl.classList.remove('hidden');
            console.log("[Theme Selector] Style options are now visible.");
        }

        // Expose saveStyle to the global scope for onclick handlers
        window.saveStyleHandler = saveStyle;

        // Initialize the app by rendering options
        renderStyleOptions();

    </script>
</body>
</html>